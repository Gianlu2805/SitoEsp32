<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documento Bootstrap</title>
  <link href="style.css" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <a class="navbar-brand" href="#">Logo</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Chi siamo</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="banner"> <!--clouds effect-->
        <div class="clouds">
            <img src="clouds/cloud1.png" style="--i:1;">
            <img src="clouds/cloud2.png" style="--i:2;">
            <img src="clouds/cloud3.png" style="--i:3;">
            <img src="clouds/cloud4.png" style="--i:4;">
            <img src="clouds/cloud5.png" style="--i:5;">
            <img src="clouds/cloud1.png" style="--i:4.5;">
            <img src="clouds/cloud2.png" style="--i:3.5;">
            <img src="clouds/cloud3.png" style="--i:2.5;">
            <img src="clouds/cloud4.png" style="--i:1.5;">
            <img src="clouds/cloud5.png" style="--i:2.3;">
        </div>
    </div>

    <div id="thunderstorm">
        <div id="raindrop"></div>
    </div>

    <div class="today">
        <div class="row">
            <div class="col">
                <div class="mainCell">
                    <p id="umidity" class="mainText">-- %</p>
                </div>
                <div class="graphCell"></div>
            </div>
            <div class="rect"></div>
            <div class="col">
                <div class="mainCell">
                    <p id="temperature" class="mainText">-- Â°</p>
                </div>
                <div class="graphCell"></div>
            </div>
            <div class="rect"></div>
            <div class="col">
                <div class="mainCell">
                    <p id="lux" class="mainText">-- lux</p>
                </div>
                <div class="graphCell"></div>
            </div>
        </div>
    </div>

    <div class="contenitore">
        

    </div>

<!-- Bootstrap JavaScript e jQuery (opzionale) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="grafics.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.0/gsap.min.js"></script> <!--to make rain-->
<script src="rain.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Function to draw the chart
    // Function to draw the chart
    async function drawDailyChart(targetElement) {
    const data = await fetchDailyData();

    // Convertire le stringhe di data in oggetti Date
    const processedData = data.map(row => ({
        datetime: new Date(row.date_time).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }), // Trim date to hh:mm format
        temperature: row.temperature.reduce((acc, val) => acc + val, 0) / row.temperature.length,
        humidity: row.humidity.reduce((acc, val) => acc + val, 0) / row.humidity.length,
        light: row.light.reduce((acc, val) => acc + val, 0) / row.light.length
    }));

    // Preparare i dati per il grafico
    const labels = processedData.map(row => row.datetime);
    const temperatureValues = processedData.map(row => row.temperature);
    const humidityValues = processedData.map(row => row.humidity);
    const lightValues = processedData.map(row => row.light);

    // Disegnare il grafico utilizzando Chart.js
    const canvas = document.createElement('canvas');
    canvas.style.width = '100%'; // Set canvas width to 100%
    canvas.style.height = '100%'; // Set canvas height to 100%
    const ctx = canvas.getContext('2d');

    const myChart = new Chart(ctx, {
        type: 'line',
        data: {
        labels: labels,
        datasets: [
            {
            label: 'Temperature',
            data: temperatureValues,
            borderColor: 'red',
            backgroundColor: 'transparent',
            borderWidth: 1,
            pointRadius: 0, // Set point radius
            },
            {
            label: 'Humidity',
            data: humidityValues,
            borderColor: 'blue',
            backgroundColor: 'transparent',
            borderWidth: 1,
            pointRadius: 0, // Set point radius
            },
            {
            label: 'Light',
            data: lightValues,
            borderColor: 'green',
            backgroundColor: 'transparent',
            borderWidth: 1,
            pointRadius: 0, // Set point radius
            }
        ]
        },
        options: {
            scales: {
                y: {
                beginAtZero: true,
                suggestedMin: 0, // Min y-value
                suggestedMax: 45 // Max y-value
                }
            }
        }
    });

    // Append the canvas to the target element
    targetElement.appendChild(canvas);
    }

    // Call drawDailyChart for each graphCell
    const graphCells = document.querySelectorAll('.graphCell');
    graphCells.forEach(cell => {
      drawDailyChart(cell);
    });

    // Function to fetch data from the API
    async function fetchDailyData() {
      const currentDate = new Date().toISOString().split('T')[0];
      const response = await fetch('https://portale.itisurbino.it/galanti/get_interval?date=' + currentDate);
      const data = await response.json();

      return data;
    }
</script>
</body>
</html>
